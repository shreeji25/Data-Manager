{% extends "base.html" %}

{% block title %}Register{% endblock %}

{% block css %}
<link rel="stylesheet" href="/static/css/auth.css">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Sora:wght@400;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="auth-page">

  <!-- Left panel: branding -->
  <div class="auth-left">
    <div class="auth-left-inner">
      <div class="auth-brand">
        <div class="auth-brand-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10 9 9 9 8 9"/>
          </svg>
        </div>
        <span class="auth-brand-name">Data Manager</span>
      </div>

      <div class="auth-left-content">
        <h1 class="auth-left-title">Manage your data<br>with confidence.</h1>
        <p class="auth-left-sub">Upload, analyse, and clean datasets. Detect duplicates across phone and email fields in seconds.</p>
        <div class="auth-features">
          <div class="auth-feature"><div class="auth-feature-dot"></div><span>Automatic duplicate detection</span></div>
          <div class="auth-feature"><div class="auth-feature-dot"></div><span>Phone &amp; email cross-matching</span></div>
          <div class="auth-feature"><div class="auth-feature-dot"></div><span>Clean &amp; export in one click</span></div>
        </div>
      </div>

      <div class="auth-left-footer">Secure · Private · Fast</div>
    </div>
  </div>

  <!-- Right panel: form -->
  <div class="auth-right">
    <div class="auth-form-wrap">

      <div class="auth-form-header">
        <h2 class="auth-form-title">Create your account</h2>
        <p class="auth-form-sub">Already have one? <a href="/login">Sign in →</a></p>
      </div>

      {% if error %}
      <div class="auth-alert">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        {{ error }}
      </div>
      {% endif %}

      <form method="POST" action="/register" class="auth-form" id="registerForm">

        <div class="auth-field">
          <label for="full_name">Full Name</label>
          <div class="auth-input-wrap">
            <svg class="auth-input-icon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
            </svg>
            <input type="text" id="full_name" name="full_name" placeholder="John Doe" value="{{ full_name or '' }}">
          </div>
        </div>

        <div class="auth-field">
          <label for="username">Username <span class="req">*</span></label>
          <div class="auth-input-wrap">
            <svg class="auth-input-icon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 20a6 6 0 0 0-12 0"/><circle cx="12" cy="10" r="4"/>
            </svg>
            <input type="text" id="username" name="username" placeholder="your_username" value="{{ username or '' }}" required autocomplete="username">
          </div>
        </div>

        <div class="auth-field">
          <label for="email">Email <span class="req">*</span></label>
          <div class="auth-input-wrap">
            <svg class="auth-input-icon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/>
            </svg>
            <input type="email" id="email" name="email" placeholder="you@company.com" value="{{ email or '' }}" required autocomplete="email">
          </div>
        </div>

        <div class="auth-row">
          <div class="auth-field">
            <label for="password">Password <span class="req">*</span></label>
            <div class="auth-input-wrap">
              <svg class="auth-input-icon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
              <input type="password" id="password" name="password" placeholder="Min 6 characters" required autocomplete="new-password" oninput="checkStrength(this.value)">
            </div>
            <div class="pwd-strength"><div class="pwd-strength-bar" id="pwdBar"></div></div>
            <span class="pwd-strength-label" id="pwdLabel"></span>
          </div>

          <div class="auth-field">
            <label for="confirm_password">Confirm Password <span class="req">*</span></label>
            <div class="auth-input-wrap">
              <svg class="auth-input-icon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
              </svg>
              <input type="password" id="confirm_password" name="confirm_password" placeholder="Repeat password" required autocomplete="new-password" oninput="checkMatch()">
            </div>
            <span class="pwd-match-label" id="matchLabel"></span>
          </div>
        </div>

        <button type="submit" class="auth-submit" id="submitBtn">
          <span>Create Account</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>

      </form>

      <p class="auth-terms">
        By creating an account you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.
      </p>

    </div>
  </div>
</div>

<script>
function checkStrength(val) {
  const bar = document.getElementById('pwdBar');
  const label = document.getElementById('pwdLabel');
  let score = 0;
  if (val.length >= 6)  score++;
  if (val.length >= 10) score++;
  if (/[A-Z]/.test(val)) score++;
  if (/[0-9]/.test(val)) score++;
  if (/[^A-Za-z0-9]/.test(val)) score++;
  const levels = [
    { w: '0%',   c: 'transparent', t: '' },
    { w: '25%',  c: '#ef4444', t: 'Weak' },
    { w: '50%',  c: '#f59e0b', t: 'Fair' },
    { w: '75%',  c: '#3b82f6', t: 'Good' },
    { w: '100%', c: '#22c55e', t: 'Strong' },
  ];
  const lvl = levels[Math.min(score, 4)];
  bar.style.width = lvl.w;
  bar.style.background = lvl.c;
  label.textContent = lvl.t;
  label.style.color = lvl.c;
}
function checkMatch() {
  const pw = document.getElementById('password').value;
  const cpw = document.getElementById('confirm_password').value;
  const lbl = document.getElementById('matchLabel');
  if (!cpw) { lbl.textContent = ''; return; }
  if (pw === cpw) { lbl.textContent = '✓ Passwords match'; lbl.style.color = '#22c55e'; }
  else { lbl.textContent = '✗ Do not match'; lbl.style.color = '#ef4444'; }
}
document.getElementById('registerForm').addEventListener('submit', function(e) {
  const pw = document.getElementById('password').value;
  const cpw = document.getElementById('confirm_password').value;
  if (pw !== cpw) {
    e.preventDefault();
    document.getElementById('matchLabel').textContent = '✗ Passwords do not match';
    document.getElementById('matchLabel').style.color = '#ef4444';
    document.getElementById('confirm_password').focus();
  }
});
</script>
{% endblock %}